#!/usr/bin/env python

"""Script for ASIST Study 3 evaluation"""

import json
from glob import glob
import argparse


def run_evaluation(args):
    for filepath in (glob(args.data_dir + "/*T00*UAZ*.metadata"))[0:1]:
        print(filepath)
        with open(filepath) as f:
            for line in f:
                message = json.loads(line)
                if (
                    "topic" in message
                    and message["topic"]
                    == "agent/intervention/ASI_UAZ_TA1_ToMCAT/chat"
                ):
                    explanation = message["data"]["explanation"][
                        "info"
                    ].replace("This intervention was triggered", "")

                    intervention_type = ""

                    if "did not get an answer" in explanation:
                        intervention_type = "Help-Request Reply"
                    elif "did not ask" in explanation:
                        intervention_type = "Help Request"
                    elif "placed a marker" in explanation:
                        intervention_type = "Marker Block"
                    elif "ensure" in explanation:
                        intervention_type = "Motivational"
                    else:
                        raise(Exception("Unknown intervention type: ", explanation))
                    print(intervention_type, "|", explanation)



if __name__ == "__main__":
    parser = argparse.ArgumentParser(
        description=__doc__,
        formatter_class=argparse.ArgumentDefaultsHelpFormatter,
    )
    parser.add_argument(
        "--data_dir",
        help="Directory containing .metadata files",
        default="/media/mule/projects/tomcat/protected/study-3_2022",
    )

    args = parser.parse_args()
    run_evaluation(args)
